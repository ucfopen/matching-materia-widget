(function(){var a;a=this;this.Widget=(function(){var g,h,s,v,n,o,q,b,k,r,d,i,m,f,u,j,c,e,t,p,l;u=null;q=null;b=null;s=null;k=null;h=null;v={};j={};c=[];p=0;m=0;g=function(){u=Materia.getQSetData();return r(Materia.getInstance().name)};e=function(x){var z,y,B,A,w;for(z=B=A=x.length-1;A<=1?B<=1:B>=1;z=A<=1?++B:--B){y=Math.floor(Math.random()*(z+1));w=[x[y],x[z]],x[z]=w[0],x[y]=w[1]}return x};r=function(C){var z,y,D,x,B,A,w;B=_.template($("#t-board").html());h=$(B({title:C,categories:u.items}));A=u.items;for(y in A){z=A[y];v[y]=z;w=z.items;for(D in w){x=w[D];if(u.options.randomize){x.answers=e(x.answers)}p++;j[x.id]=x}}h.find(".question").on("click",f);return $("body").append(h)};f=function(y){var x,w;s=$(y.target);q=v[s.parent(".category").data("id")];b=j[s.data("id")];k=parseInt(s.html(),10);w=_.template($("#t-question-page").html());x=$(w({index:k,id:b.id,answers:b.answers,category:q.name,question:b.questions[0].text}));x.find(".button.return").on("click",o);x.find(".button.submit").on("click",t);x.find(".answers input").on("click",function(z){$(".answers li").removeClass("selected");$(z.target).parent("li").addClass("selected");return x.find(".button.submit").prop("disabled",false)});h.hide();return $("body").append(x)};t=function(){var w,x,z,y;w=$(".answers input[type='radio']:checked");z=w.val();x=n(b,z);Score.submitQuestionForScoring(b.id,x.text);c.push(x.score);l();y=""+q.name+" question  #"+k+" ";if(x.score===100){w.parents("li").prepend('<span class="correct mark">&#x2714;</span>');s.addClass("correct").html("&#x2714;").attr("title",""+y+" Correct")}else{w.parents("li").prepend('<span class="wrong mark">X</span>');s.addClass("wrong").html("X").attr("title",""+y+" Wrong")}$(".answers input[type='radio']").prop("disabled",true);$(".button.submit").prop("disabled",true);$(".button.return").addClass("highlight");$(".answers ul").addClass("answered");if(x.feedback!=null){w.parents("li").append('<span class="feedback"><strong>Feedback:</strong> '+x.feedback+"</span>")}return s.removeClass("unanswered").off("click")};d=function(){var w,x;x=_.template($("#t-finish-notice").html());w=$(x({score:m}));w.find("button").on("click",i);h.hide();return $("body").append(w)};l=function(){var x,y,w;m=0;for(y=0,w=c.length;y<w;y++){x=c[y];m+=x}m=Math.round(m/p);return $(".score .value").html(m)};n=function(x,B){var A,z,w,y;y=x.answers;for(z=0,w=y.length;z<w;z++){A=y[z];if(A.id===B){return{score:parseInt(A.value,10),text:A.text,feedback:A.options.feedback}}}throw Error("Submitted answer not in this questions")};o=function(){$(".screen.question").remove();h.show();if(c.length===p){return d()}};i=function(){return Materia.end()};return{start:g}})()}).call(this);